<!DOCTYPE html>
<html>
<head>
<!--     <meta charset="utf-8"> -->
<!--     <meta name="viewport" -->
<!--           content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"> -->
<!--     <meta name="description" content="浪迹在上海N年的一名专业搬砖小王子,自称 &quot;编程浪子&quot;，希望自己畅游在互联网的世界做一名放荡不羁的浪子，和编程来一次一万年的恋爱"/> -->
<!--     <meta name="keywords" content="php教程，python教程，php开发，编程浪子的博客"> -->
<!--     <title>编程浪子的梦博客</title> -->
<!--     <meta name="HandheldFriendly" content="True"/> -->
<!--     <meta name="google-site-verification" content="c_1LAxAX-8MMoXntjVS1kCu5JnGhVIlcgLT6idZpgq4" /> -->
<!--     <link rel="shortcut icon" href="http://cdn.static.54php.cn/images/icon.png"> -->
<!--     <link rel="icon" href="http://cdn.static.54php.cn/images/icon.png"> -->
<!--     <link href="http://cdn.static.54php.cn/amazeui/css/amazeui.min.css" rel="stylesheet"> -->
<!-- <link href="/css/wap/common.css" rel="stylesheet">     -->
</head>
<body>
<div class="am-g">
<!--     <section> -->
<!--         <ol class="am-breadcrumb"> -->
<!-- 	<li><a href="http://m.54php.cn/demo/index">Demo列表</a></li> -->
<!-- 	<li class="am-active">H5上传和拍照</li> -->
<!-- </ol> -->
<div class="am-paragraph am-paragraph-default">
	<article class="am-article">
		<div class="am-article-hd">
			<h1 class="am-article-title">H5上传和拍照</h1>
		</div>
		<hr data-am-widget="divider"  class="am-divider am-divider-default"/>
		<div class="am-article-bd  ">
			<div class="am-form-group am-form-file">
<!-- 				<button type="button" class="am-btn am-btn-danger am-btn-sm"> -->
<!-- 					<i class="am-icon-cloud-upload"></i> 选择要上传的文件 -->
<!-- 				</button> -->
				选择要上传的文件:<input id="upload" type="file" accept="image/*;" capture="camera" >
			</div>
		</div>

		<figure data-am-widget="figure" class="am am-figure am-figure-default am-no-layout">
			<img  class="img_wrap" style="display: none;">
		</figure>
	</article>
</div>



<div data-am-widget="gotop" class="am-gotop am-gotop-fixed" style="display: none;">
    <a href="#top" title="回到顶部">
        <span class="am-gotop-title">回到顶部</span>
        <i class="am-gotop-icon am-icon-chevron-up"></i>
    </a>
</div>
<script src="../../js/jquery.js"></script> <!-- jQuery -->

<!-- <input type="hidden" id="access_domain" value="http://www.54php.cn/"></div> -->
<!-- <script src="http://cdn.static.54php.cn/jquery/jquery.min.js"></script> -->
<!-- <script src="http://cdn.static.54php.cn/amazeui/js/amazeui.min.js"></script> -->
<!-- <script src="http://cdn.static.54php.cn/amazeui/js/amazeui.ie8polyfill.min.js"></script> -->
<!-- <script src="http://cdn.static.54php.cn/amazeui/js/amazeui.widgets.helper.min.js"></script> -->
<!-- <script src="/js/wap/common.js"></script> -->
<!-- <script src="/js/access.js"></script> -->
<!-- <script src="/js/wap/demo/h5_upload.js?version=20170625012526"></script><div style="display:none"> -->
	<script type="text/javascript">
	var demo_h5_upload_ops = {
	    init:function(){
	        this.eventBind();
	    },
	    eventBind:function(){
	        var that = this;
	        $("#upload").change(function(){
	            var reader = new FileReader();
	            reader.onload = function (e) {
	                that.compress(this.result);
	            };
	            reader.readAsDataURL(this.files[0]);
	        });
	    },
	    compress : function (res) {
	        var that = this;
	        var img = new Image(),
	            maxH = 300;

	        img.onload = function () {
	            var cvs = document.createElement('canvas'),
	                ctx = cvs.getContext('2d');

	            if(img.height > maxH) {
	                img.width *= maxH / img.height;
	                img.height = maxH;
	            }
	            cvs.width = img.width;
	            cvs.height = img.height;

	            ctx.clearRect(0, 0, cvs.width, cvs.height);
	            ctx.drawImage(img, 0, 0, img.width, img.height);
	            var dataUrl = cvs.toDataURL('image/jpeg', 1);
	            $(".img_wrap").attr("src",dataUrl);
	            $(".img_wrap").show();
	            // 上传略
	            that.upload( dataUrl );
	        };

	        img.src = res;
	    },
	    upload:function( image_data ){
	        /*上次方法屏蔽了*/
	        alert('up');
	        return;
	        $.ajax({
	            url:common_ops.buildWapUrl("/demo/h5_upload"),
	            type:'POST',
	            data:{ image_data:image_data },
	            dataType:'json',
	            success:function( res ){

	            }
	        });
	    }
	};


	$(document).ready( function(){
	    demo_h5_upload_ops.init();
	} );
	</script>
	
<script>
// var _hmt = _hmt || [];
// (function() {
//   var hm = document.createElement("script");
//   hm.src = "https://hm.baidu.com/hm.js?0e66d67ac5c76a6aa30e1d1ac590e6b7";
//   var s = document.getElementsByTagName("script")[0]; 
//   s.parentNode.insertBefore(hm, s);
// })();
</script>

</div>
</body>
</html>
